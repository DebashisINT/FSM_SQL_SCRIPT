--EXEC PRC_FTSATTENDANCEVSPRODUCTIVITYRATIO_REPORT '2020-01-01','2020-01-31','','','EMA0000007',378
--EXEC PRC_FTSATTENDANCEVSPRODUCTIVITYRATIO_REPORT '2020-05-01','2020-05-31','','','',378

IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[PRC_FTSATTENDANCEVSPRODUCTIVITYRATIO_REPORT]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [PRC_FTSATTENDANCEVSPRODUCTIVITYRATIO_REPORT] AS' 
END
GO

ALTER PROCEDURE [dbo].[PRC_FTSATTENDANCEVSPRODUCTIVITYRATIO_REPORT]
(
@FROMDATE NVARCHAR(10)=NULL,
@TODATE NVARCHAR(10)=NULL,
@STATEID NVARCHAR(MAX)=NULL,
@DESIGNID NVARCHAR(MAX)=NULL,
@EMPID NVARCHAR(MAX)=NULL,
@USERID INT
) WITH ENCRYPTION
AS
/****************************************************************************************************************************************************************************
Written by : Debashis Talukder On 20/05/2020
Module	   : Attendance Vs Productivity Ratio.Refer: 0022357
1.0		v2.0.13		Debashis	16/06/2020		Logout Time showing wrong as it was considered 12hrs format.Now it has been made 24hrs format and issue has been taken 
												care of.Refer: 0022499
2.0		v2.0.13		Debashis	16/07/2020		1. App Logout time is not considering if the attendance type is leave. Even if anyone forget to logout for the day,
												it should be updated with 23.59 hrs.
												2. Meeting type should be consider for first & last call. Currently, if anyone make the first call as meeting or the last call 
												as meeting, it is not considering.Refer: 0022686
3.0		v2.0.38		Sanchita	03/02/2023		Appconfig and User wise setting "IsAllDataInPortalwithHeirarchy = True" 
												then data in portal shall be populated based on Hierarchy Only. Refer: 25504
****************************************************************************************************************************************************************************/
BEGIN
	SET NOCOUNT ON

	DECLARE @Strsql NVARCHAR(MAX),@sqlStrTable NVARCHAR(MAX)

	IF OBJECT_ID('tempdb..#STATEID_LIST') IS NOT NULL
		DROP TABLE #STATEID_LIST
	CREATE TABLE #STATEID_LIST (State_Id INT)
	CREATE NONCLUSTERED INDEX IX1 ON #STATEID_LIST (State_Id ASC)
	IF @STATEID <> ''
		BEGIN
			SET @STATEID=REPLACE(@STATEID,'''','')
			SET @sqlStrTable=''
			SET @sqlStrTable=' INSERT INTO #STATEID_LIST SELECT id from tbl_master_state where id in('+@STATEID+')'
			EXEC SP_EXECUTESQL @sqlStrTable
		END
	
	IF OBJECT_ID('tempdb..#DESIGNATION_LIST') IS NOT NULL
		DROP TABLE #DESIGNATION_LIST
	CREATE TABLE #DESIGNATION_LIST (deg_id INT)
	CREATE NONCLUSTERED INDEX IX2 ON #DESIGNATION_LIST (deg_id ASC)
	IF @DESIGNID <> ''
		BEGIN
			SET @DESIGNID=REPLACE(@DESIGNID,'''','')
			SET @sqlStrTable=''
			SET @sqlStrTable=' INSERT INTO #DESIGNATION_LIST SELECT deg_id from tbl_master_designation where deg_id in('+@DESIGNID+')'
			EXEC SP_EXECUTESQL @sqlStrTable
		END

	IF OBJECT_ID('tempdb..#EMPLOYEE_LIST') IS NOT NULL
		DROP TABLE #EMPLOYEE_LIST
	CREATE TABLE #EMPLOYEE_LIST (emp_contactId NVARCHAR(100) COLLATE SQL_Latin1_General_CP1_CI_AS)
	IF @EMPID <> ''
		BEGIN
			SET @EMPID = REPLACE(''''+@EMPID+'''',',',''',''')
			SET @sqlStrTable=''
			SET @sqlStrTable=' INSERT INTO #EMPLOYEE_LIST SELECT emp_contactId from tbl_master_employee where emp_contactId in('+@EMPID+')'
			EXEC SP_EXECUTESQL @sqlStrTable
		END

	-- Rev 3.0
	DECLARE @user_contactId NVARCHAR(15)
	SELECT @user_contactId=user_contactId  from tbl_master_user WITH(NOLOCK) where user_id=@USERID

	IF ((select IsAllDataInPortalwithHeirarchy from tbl_master_user where user_id=@USERID)=1)
	BEGIN
		CREATE TABLE #EMPHR
		(
		EMPCODE VARCHAR(50),
		RPTTOEMPCODE VARCHAR(50)
		)

		CREATE TABLE #EMPHR_EDIT
		(
		EMPCODE VARCHAR(50),
		RPTTOEMPCODE VARCHAR(50)
		)
		
		INSERT INTO #EMPHR
		SELECT emp_cntId EMPCODE,ISNULL(TME.emp_contactId,'') RPTTOEMPCODE 
		FROM tbl_trans_employeeCTC CTC LEFT JOIN tbl_master_employee TME on TME.emp_id= CTC.emp_reportTO WHERE emp_effectiveuntil IS NULL
		
		;with cte as(select	
		EMPCODE,RPTTOEMPCODE
		from #EMPHR 
		where EMPCODE IS NULL OR EMPCODE=@user_contactId  
		union all
		select	
		a.EMPCODE,a.RPTTOEMPCODE
		from #EMPHR a
		join cte b
		on a.RPTTOEMPCODE = b.EMPCODE
		) 
		INSERT INTO #EMPHR_EDIT
		select EMPCODE,RPTTOEMPCODE  from cte 

	END
	-- End of Rev 3.0

	IF OBJECT_ID('tempdb..#TEMPCONTACT') IS NOT NULL
		DROP TABLE #TEMPCONTACT
	CREATE TABLE #TEMPCONTACT
		(
			cnt_internalId NVARCHAR(10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			cnt_firstName NVARCHAR(150) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			cnt_middleName NVARCHAR(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			cnt_lastName NVARCHAR(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
			cnt_contactType NVARCHAR(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
		)
	CREATE NONCLUSTERED INDEX IX_PARTYID ON #TEMPCONTACT(cnt_internalId,cnt_contactType ASC)
	-- Rev 3.0
	--INSERT INTO #TEMPCONTACT
	--SELECT cnt_internalId,cnt_firstName,cnt_middleName,cnt_lastName,cnt_contactType FROM TBL_MASTER_CONTACT WHERE cnt_contactType IN('EM')

	SET @Strsql=''
	SET @Strsql+=' INSERT INTO #TEMPCONTACT '
	SET @Strsql+=' SELECT cnt_internalId,cnt_firstName,cnt_middleName,cnt_lastName,cnt_contactType FROM TBL_MASTER_CONTACT CNT ' 
	IF ((select IsAllDataInPortalwithHeirarchy from tbl_master_user where user_id=@USERID)=1)
	BEGIN
		SET @Strsql+=' INNER JOIN #EMPHR_EDIT HRY ON CNT.cnt_internalId=HRY.EMPCODE '
	END
	SET @Strsql+=' WHERE cnt_contactType IN(''EM'') '
	exec sp_executesql @Strsql
	-- End of Rev 3.0

	IF NOT EXISTS (SELECT * FROM sys.objects WHERE OBJECT_ID=OBJECT_ID(N'FTSATTENDANCEVSPRODUCTIVITYRATIO_REPORT') AND TYPE IN (N'U'))
		BEGIN
			CREATE TABLE FTSATTENDANCEVSPRODUCTIVITYRATIO_REPORT
			(
			  USERID INT,
			  SEQ INT,
			  LOGIN_DATE NVARCHAR(10),
			  CONTACTNO NVARCHAR(50) NULL,
			  EMPID NVARCHAR(100) NULL,
			  EMPCODE NVARCHAR(100) NULL,
			  EMPNAME NVARCHAR(300) NULL,
			  STATEID INT,
			  STATE NVARCHAR(50) NULL,
			  DEG_ID INT,
			  DESIGNATION NVARCHAR(50) NULL,
			  DATEOFJOINING NVARCHAR(10),
			  OFFICE_ADDRESS NVARCHAR(300),
			  REPORTTO NVARCHAR(300) NULL,
			  RPTTODESG NVARCHAR(50) NULL,
			  ATTEN_STATUS NVARCHAR(20),
			  WORK_LEAVE_TYPE NVARCHAR(2000) NULL,
			  REMARKS NVARCHAR(2000) NULL,
			  ACTINTIME NVARCHAR(20) NULL,
			  ACTGRACEINTIME NVARCHAR(20) NULL,
			  ALTINTIME NVARCHAR(20) NULL,
			  ALTGRACEINTIME NVARCHAR(20) NULL,
			  APPLOGGEDIN NVARCHAR(20) NULL,
			  FIRSTCALLTIME NVARCHAR(20) NULL,
			  LASTCALLTIME NVARCHAR(20) NULL,
			  APPLOGEDOUT NVARCHAR(20) NULL,
			  ATTENDANCETYPE NVARCHAR(20) NULL,
			  ATTENDANCESTATUS NVARCHAR(30) NULL,
			  WORKINGDURATION NVARCHAR(20) NULL,
			  UNDERTIME NVARCHAR(20) NULL,
			  GPS_INACTIVE_DURATION NVARCHAR(20) NULL,
			  GPSINACTIVECNT INT,
			  IDEAL_TIME NVARCHAR(20) NULL,
			  IDEALTIME_CNT INT,
			  NEWSHOP_VISITED INT,
			  RE_VISITED INT,
			  TOTMETTING INT,
			  TOTALORDER DECIMAL(38,2),
			  TOTALDELV DECIMAL(38,2),
			  TOTALCOLLECTION DECIMAL(38,2),
			  TC INT,
			  PC INT,
			  PRATIO DECIMAL(38,2),
			  DROPSIZE DECIMAL(38,2),
			  PJPCNT INT,
			  COVERAGE DECIMAL(38,2)
			)
			CREATE NONCLUSTERED INDEX IX1 ON FTSATTENDANCEVSPRODUCTIVITYRATIO_REPORT (SEQ)
		END
	DELETE FROM FTSATTENDANCEVSPRODUCTIVITYRATIO_REPORT WHERE USERID=@USERID

	SET @Strsql=''
	SET @Strsql='INSERT INTO FTSATTENDANCEVSPRODUCTIVITYRATIO_REPORT(USERID,SEQ,LOGIN_DATE,CONTACTNO,EMPID,EMPCODE,EMPNAME,STATEID,STATE,DEG_ID,DESIGNATION,DATEOFJOINING,OFFICE_ADDRESS,REPORTTO,RPTTODESG,'
	SET @Strsql+='ATTEN_STATUS,WORK_LEAVE_TYPE,REMARKS,ACTINTIME,ACTGRACEINTIME,ALTINTIME,ALTGRACEINTIME,APPLOGGEDIN,FIRSTCALLTIME,LASTCALLTIME,APPLOGEDOUT,ATTENDANCETYPE,ATTENDANCESTATUS,WORKINGDURATION,'
	SET @Strsql+='UNDERTIME,GPS_INACTIVE_DURATION,GPSINACTIVECNT,IDEAL_TIME,IDEALTIME_CNT,NEWSHOP_VISITED,RE_VISITED,TOTMETTING,TOTALORDER,TOTALDELV,TOTALCOLLECTION,TC,PC,PRATIO,DROPSIZE,PJPCNT,COVERAGE) '
	SET @Strsql+='SELECT '+LTRIM(RTRIM(STR(@USERID)))+' AS USERID,ROW_NUMBER() OVER(ORDER BY EMPNAME,LOGIN_DATETIME) AS SEQ,LOGIN_DATETIME,CONTACTNO,EMPID,EMPCODE,EMPNAME,STATEID,STATE,DEG_ID,DESIGNATION,'
	SET @Strsql+='DATEOFJOINING,OFFICE_ADDRESS,REPORTTO,RPTTODESG,ATTEN_STATUS,WORK_LEAVE_TYPE,REMARKS,ACTINTIME,ACTGRACEINTIME,ALTINTIME,ALTGRACEINTIME,APPLOGGEDIN,FIRSTCALLTIME,LASTCALLTIME,APPLOGEDOUT,'
	SET @Strsql+='ATTENDANCETYPE,ATTENDANCESTATUS,'
	SET @Strsql+='CASE WHEN WORKINGDURATION>0 THEN RIGHT(''0'' + CAST(CAST(WORKINGDURATION AS VARCHAR)/ 60 AS VARCHAR),2)  + '':'' +RIGHT(''0'' + CAST(CAST(WORKINGDURATION AS VARCHAR) % 60 AS VARCHAR),2) ELSE ''00:00'' END AS WORKINGDURATION,'
	SET @Strsql+='CASE WHEN UNDERTIME>0 THEN RIGHT(''0'' + CAST(CAST(UNDERTIME AS VARCHAR)/ 60 AS VARCHAR),2)  + '':'' +RIGHT(''0'' + CAST(CAST(UNDERTIME AS VARCHAR) % 60 AS VARCHAR),2) ELSE ''00:00'' END AS UNDERTIME,'
	SET @Strsql+='CASE WHEN GPS_INACTIVE_DURATION>0 THEN RIGHT(''0'' + CAST(CAST(GPS_INACTIVE_DURATION AS VARCHAR)/ 60 AS VARCHAR),2)  + '':'' +RIGHT(''0'' + CAST(CAST(GPS_INACTIVE_DURATION AS VARCHAR) % 60 AS VARCHAR),2) ELSE ''00:00'' END AS GPS_INACTIVE_DURATION,'
	SET @Strsql+='GPSINACTIVECNT,RIGHT(''0'' + CAST(CAST(IDEAL_TIME AS VARCHAR)/ 60 AS VARCHAR),2)  + '':'' +RIGHT(''0'' + CAST(CAST(IDEAL_TIME AS VARCHAR) % 60 AS VARCHAR),2) AS IDEAL_TIME,'	
	SET @Strsql+='IDEALTIME_CNT,NEWSHOP_VISITED,RE_VISITED,TOTMETTING,TOTALORDER,TOTALDELV,TOTALCOLLECTION,TC,PC,'
	SET @Strsql+='CAST((CAST(PC AS DECIMAL(18,2))/CASE WHEN TC<>0 THEN CAST(TC AS DECIMAL(18,2)) ELSE 1 END)*100 AS DECIMAL(18,2)) AS PRATIO,'
	SET @Strsql+='CAST((TOTALORDER/(CASE WHEN PC<>0 THEN PC ELSE 1 END)) AS DECIMAL(18,2)) AS DROPSIZE,PJPCNT,'
	SET @Strsql+='CAST((CAST(TC AS DECIMAL(18,2))/CASE WHEN PJPCNT<>0 THEN CAST(PJPCNT AS DECIMAL(18,2)) ELSE 1 END)*100 AS DECIMAL(18,2)) AS COVERAGE '
	SET @Strsql+='FROM('
	SET @Strsql+='SELECT CNT.cnt_internalId AS EMPCODE,ISNULL(CNT.CNT_FIRSTNAME,'''')+'' ''+ISNULL(CNT.CNT_MIDDLENAME,'''')+'' ''+ISNULL(CNT.CNT_LASTNAME,'''') AS EMPNAME,ISNULL(ST.ID,0) AS STATEID,'
	SET @Strsql+='ISNULL(ST.state,''State Undefined'') AS STATE,DESG.DEG_ID,DESG.deg_designation AS DESIGNATION,CONVERT(NVARCHAR(10),EMP.emp_dateofJoining,105) AS DATEOFJOINING,USR.user_loginId AS CONTACTNO,'
	--Rev 1.0
	--SET @Strsql+='RPTTO.REPORTTO,RPTTO.RPTTODESG,LOGIN_DATETIME,REPLACE(REPLACE(ATTEN.LOGGEDIN,''AM'','' AM''),''PM'','' PM'') AS APPLOGGEDIN,REPLACE(REPLACE(LOGEDOUT,''AM'','' AM''),''PM'','' PM'') AS APPLOGEDOUT,'
	SET @Strsql+='RPTTO.REPORTTO,RPTTO.RPTTODESG,LOGIN_DATETIME,ATTEN.LOGGEDIN AS APPLOGGEDIN,ATTEN.LOGEDOUT AS APPLOGEDOUT,'
	--End of Rev 1.0
	SET @Strsql+='ADDR.add_address1+'' ''+ISNULL(ADDR.add_address2,'''')+'' ''+ISNULL(ADDR.add_address3,'''') AS OFFICE_ADDRESS,EMP.emp_uniqueCode AS EMPID,ATTEN_STATUS,'
	SET @Strsql+='(SELECT DISTINCT ISNULL(STUFF((SELECT '','' + LTRIM(RTRIM(WRKACT.WrkActvtyDescription)) From tbl_fts_UserAttendanceLoginlogout AS ATTEN '
	SET @Strsql+='INNER JOIN tbl_master_user MUSR ON MUSR.USER_ID=ATTEN.USER_ID AND MUSR.user_inactive=''N'' AND MUSR.USER_ID=USR.USER_ID '
	SET @Strsql+='INNER JOIN tbl_attendance_worktype ATTENWRKTYP ON ATTENWRKTYP.UserID=ATTEN.User_Id AND ATTEN.Id=ATTENWRKTYP.attendanceid '
	SET @Strsql+='INNER JOIN tbl_FTS_WorkActivityList WRKACT ON WRKACT.WorkActivityID=ATTENWRKTYP.worktypeID '   
	SET @Strsql+='WHERE CONVERT(NVARCHAR(10),ATTEN.Work_datetime,120) BETWEEN CONVERT(NVARCHAR(10),'''+@FROMDATE+''',120) AND CONVERT(NVARCHAR(10),'''+@TODATE+''',120) '
	SET @Strsql+='AND Login_datetime IS NOT NULL AND Logout_datetime IS NULL AND Isonleave=''false'' '
	SET @Strsql+='GROUP BY WRKACT.WrkActvtyDescription FOR XML PATH('''')), 1, 1, ''''),'''')) AS WORK_LEAVE_TYPE,'
	SET @Strsql+='REPLACE((SELECT DISTINCT ISNULL(STUFF((SELECT '','' + LTRIM(RTRIM(ISNULL(A.Work_Desc,''''))) From tbl_fts_UserAttendanceLoginlogout AS A '
	SET @Strsql+='INNER JOIN tbl_master_user MUSR ON MUSR.USER_ID=A.USER_ID AND MUSR.user_inactive=''N'' AND MUSR.USER_ID=USR.USER_ID '
	SET @Strsql+='WHERE CONVERT(NVARCHAR(10),A.Work_datetime,120) BETWEEN CONVERT(NVARCHAR(10),'''+@FROMDATE+''',120) AND CONVERT(NVARCHAR(10),'''+@TODATE+''',120) '
	SET @Strsql+='AND A.Login_datetime IS NOT NULL AND A.Logout_datetime IS NULL AND A.Isonleave=''false'' AND ATTEN.Login_datetime=CONVERT(NVARCHAR(10),A.Work_datetime,105) '
	SET @Strsql+='FOR XML PATH('''')),1,1,''''),'''')),'','','''') AS REMARKS,REPLACE(REPLACE(ATTEN.ACTINTIME,''AM'','' AM''),''PM'','' PM'') AS ACTINTIME,'
	SET @Strsql+='REPLACE(REPLACE(ATTEN.ACTGRACEINTIME,''AM'','' AM''),''PM'','' PM'') AS ACTGRACEINTIME,REPLACE(REPLACE(ATTEN.ALTINTIME,''AM'','' AM''),''PM'','' PM'') AS ALTINTIME,'
	--Rev 2.0
	--SET @Strsql+='REPLACE(REPLACE(ATTEN.ALTGRACEINTIME,''AM'','' AM''),''PM'','' PM'') AS ALTGRACEINTIME,REPLACE(REPLACE(SHOPACT.FIRSTCALLTIME,''AM'','' AM''),''PM'','' PM'') AS FIRSTCALLTIME,'
	--SET @Strsql+='REPLACE(REPLACE(SHOPACT.LASTCALLTIME,''AM'','' AM''),''PM'','' PM'') AS LASTCALLTIME,LOCALOUTST.ATTENDANCETYPE,'
	SET @Strsql+='REPLACE(REPLACE(ATTEN.ALTGRACEINTIME,''AM'','' AM''),''PM'','' PM'') AS ALTGRACEINTIME,SHOPACT.FIRSTCALLTIME AS FIRSTCALLTIME,SHOPACT.LASTCALLTIME AS LASTCALLTIME,LOCALOUTST.ATTENDANCETYPE,'
	--End of Rev 2.0
	SET @Strsql+='CASE WHEN LOCALOUTST.ATTENDANCETYPE=''Local'' THEN (CASE WHEN CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ATTEN.ACTGRACEINTIME),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ATTEN.ACTGRACEINTIME),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT)=CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ATTEN.LOGGEDIN),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ATTEN.LOGGEDIN),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) THEN ''Ontime'' '
	SET @Strsql+='WHEN CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ATTEN.ACTGRACEINTIME),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ATTEN.ACTGRACEINTIME),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT)>CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ATTEN.LOGGEDIN),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ATTEN.LOGGEDIN),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) THEN ''Before Time'' '
	SET @Strsql+='WHEN CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ATTEN.ACTGRACEINTIME),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ATTEN.ACTGRACEINTIME),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT)<CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ATTEN.LOGGEDIN),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ATTEN.LOGGEDIN),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) THEN ''Late'' END) '
	SET @Strsql+='WHEN LOCALOUTST.ATTENDANCETYPE=''Outstation'' THEN (CASE WHEN CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ATTEN.ALTGRACEINTIME),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ATTEN.ALTGRACEINTIME),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT)=CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ATTEN.LOGGEDIN),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ATTEN.LOGGEDIN),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) THEN ''Ontime'' '
	SET @Strsql+='WHEN CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ATTEN.ALTGRACEINTIME),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ATTEN.ALTGRACEINTIME),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT)>CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ATTEN.LOGGEDIN),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ATTEN.LOGGEDIN),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) THEN ''Before Time'' '
	SET @Strsql+='WHEN CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ATTEN.ALTGRACEINTIME),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ATTEN.ALTGRACEINTIME),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT)<CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ATTEN.LOGGEDIN),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ATTEN.LOGGEDIN),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) THEN ''Late'' END) ELSE NULL END AS ATTENDANCESTATUS,'
	SET @Strsql+='CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(SHOPACT.LASTCALLTIME,''00:00:00'')) * 60) AS FLOAT) +CAST(DATEPART(MINUTE,ISNULL(SHOPACT.LASTCALLTIME,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) '
	SET @Strsql+='- CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(SHOPACT.FIRSTCALLTIME,''00:00:00'')) * 60) AS FLOAT) +CAST(DATEPART(MINUTE,ISNULL(SHOPACT.FIRSTCALLTIME,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) AS WORKINGDURATION,'
	SET @Strsql+='CASE WHEN LOCALOUTST.ATTENDANCETYPE=''Local'' THEN '
	SET @Strsql+='(CASE WHEN CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(SHOPACT.LASTCALLTIME,''00:00:00'')) * 60) AS FLOAT) +CAST(DATEPART(MINUTE,ISNULL(SHOPACT.LASTCALLTIME,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) '
	SET @Strsql+='- CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(SHOPACT.FIRSTCALLTIME,''00:00:00'')) * 60) AS FLOAT) +CAST(DATEPART(MINUTE,ISNULL(SHOPACT.FIRSTCALLTIME,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT)>0 THEN '
	SET @Strsql+='ATTEN.ACTWORKTIME-(CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(SHOPACT.LASTCALLTIME,''00:00:00'')) * 60) AS FLOAT) +CAST(DATEPART(MINUTE,ISNULL(SHOPACT.LASTCALLTIME,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) '
	SET @Strsql+='- CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(SHOPACT.FIRSTCALLTIME,''00:00:00'')) * 60) AS FLOAT) +CAST(DATEPART(MINUTE,ISNULL(SHOPACT.FIRSTCALLTIME,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT)) ELSE '
	SET @Strsql+='ATTEN.ACTWORKTIME-(CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(''23:59:00'',''00:00:00'')) * 60) AS FLOAT) +CAST(DATEPART(MINUTE,ISNULL(''23:59:00'',''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) '
	SET @Strsql+='- CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(SHOPACT.FIRSTCALLTIME,''00:00:00'')) * 60) AS FLOAT) +CAST(DATEPART(MINUTE,ISNULL(SHOPACT.FIRSTCALLTIME,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT)) END) '
	SET @Strsql+='WHEN LOCALOUTST.ATTENDANCETYPE=''Outstation'' THEN '
	SET @Strsql+='(CASE WHEN CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(SHOPACT.LASTCALLTIME,''00:00:00'')) * 60) AS FLOAT) +CAST(DATEPART(MINUTE,ISNULL(SHOPACT.LASTCALLTIME,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) '
	SET @Strsql+='- CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(SHOPACT.FIRSTCALLTIME,''00:00:00'')) * 60) AS FLOAT) +CAST(DATEPART(MINUTE,ISNULL(SHOPACT.FIRSTCALLTIME,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT)>0 THEN '
	SET @Strsql+='ATTEN.ALTWORKTIME-(CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(SHOPACT.LASTCALLTIME,''00:00:00'')) * 60) AS FLOAT) +CAST(DATEPART(MINUTE,ISNULL(SHOPACT.LASTCALLTIME,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) '
	SET @Strsql+='- CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(SHOPACT.FIRSTCALLTIME,''00:00:00'')) * 60) AS FLOAT) +CAST(DATEPART(MINUTE,ISNULL(SHOPACT.FIRSTCALLTIME,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT)) ELSE '
	SET @Strsql+='ATTEN.ALTWORKTIME-(CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(''23:59:00'',''00:00:00'')) * 60) AS FLOAT) +CAST(DATEPART(MINUTE,ISNULL(''23:59:00'',''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) '
	SET @Strsql+='- CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(SHOPACT.FIRSTCALLTIME,''00:00:00'')) * 60) AS FLOAT) +CAST(DATEPART(MINUTE,ISNULL(SHOPACT.FIRSTCALLTIME,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT)) END) END AS UNDERTIME,'
	--Rev 2.0
	--SET @Strsql+='GPSSM.GPS_Inactive_duration,ISNULL(GPSSM.GPSINACTIVECNT,0) AS GPSINACTIVECNT,IDEALLOACTION.IDEAL_TIME,(IDEALLOACTION.IDEAL_TIME/30) AS IDEALTIME_CNT,ISNULL(MEET.TOTMETTING,0) AS TOTMETTING,'
	--SET @Strsql+='ISNULL(SHOPACT.NEWSHOP_VISITED,0)+ISNULL(SHOPACT.RE_VISITED,0)+ISNULL(MEET.TOTMETTING,0) AS TC,ISNULL(ORDHEAD.ORDCNT,0) AS PC,ISNULL(PJPDET.PJPCNT,0) AS PJPCNT,'
	SET @Strsql+='GPSSM.GPS_Inactive_duration,ISNULL(GPSSM.GPSINACTIVECNT,0) AS GPSINACTIVECNT,IDEALLOACTION.IDEAL_TIME,(IDEALLOACTION.IDEAL_TIME/30) AS IDEALTIME_CNT,ISNULL(SHOPACT.TOTMETTING,0) AS TOTMETTING,'
	SET @Strsql+='ISNULL(SHOPACT.NEWSHOP_VISITED,0)+ISNULL(SHOPACT.RE_VISITED,0)+ISNULL(SHOPACT.TOTMETTING,0) AS TC,ISNULL(ORDHEAD.ORDCNT,0) AS PC,ISNULL(PJPDET.PJPCNT,0) AS PJPCNT,'
	--End of Rev 2.0
	SET @Strsql+='ISNULL(SHOPACT.NEWSHOP_VISITED,0) AS NEWSHOP_VISITED,ISNULL(SHOPACT.RE_VISITED,0) AS RE_VISITED,ISNULL(ORDHEAD.Ordervalue,0) AS TOTALORDER,ISNULL(BH.Invvalue,0) AS TOTALDELV,'
	SET @Strsql+='ISNULL(COLLEC.collectionvalue,0) AS TOTALCOLLECTION FROM tbl_master_employee EMP '
	SET @Strsql+='INNER JOIN #TEMPCONTACT CNT ON CNT.cnt_internalId=EMP.emp_contactId '
	SET @Strsql+='INNER JOIN tbl_master_user USR ON USR.user_contactId=EMP.emp_contactId AND USR.user_inactive=''N'' '
	SET @Strsql+='INNER JOIN tbl_master_address ADDR ON ADDR.add_cntId=CNT.cnt_internalid AND ADDR.add_addressType=''Office'' '
	SET @Strsql+='INNER JOIN tbl_master_state ST ON ST.id=ADDR.add_state '
	SET @Strsql+='INNER JOIN ( '
	SET @Strsql+='SELECT cnt.emp_cntId,desg.deg_designation,MAX(emp_id) as emp_id,desg.deg_id FROM tbl_trans_employeeCTC as cnt '
	SET @Strsql+='LEFT OUTER JOIN tbl_master_designation desg ON desg.deg_id=cnt.emp_Designation WHERE cnt.emp_effectiveuntil IS NULL GROUP BY emp_cntId,desg.deg_designation,desg.deg_id) DESG ON DESG.emp_cntId=EMP.emp_contactId '
	SET @Strsql+='LEFT OUTER JOIN (SELECT EMPCTC.emp_cntId,EMPCTC.emp_reportTo,CNT.cnt_internalId,ISNULL(CNT.CNT_FIRSTNAME,'''')+'' ''+ISNULL(CNT.CNT_MIDDLENAME,'''')+'' ''+ISNULL(CNT.CNT_LASTNAME,'''') AS REPORTTO,'
	SET @Strsql+='DESG.deg_designation AS RPTTODESG FROM tbl_master_employee EMP '
	SET @Strsql+='INNER JOIN tbl_trans_employeeCTC EMPCTC ON EMP.emp_id=EMPCTC.emp_reportTo '
	SET @Strsql+='INNER JOIN #TEMPCONTACT CNT ON CNT.cnt_internalId=EMP.emp_contactId '
	SET @Strsql+='INNER JOIN ( '
	SET @Strsql+='SELECT cnt.emp_cntId,desg.deg_designation,MAX(emp_id) as emp_id,desg.deg_id FROM tbl_trans_employeeCTC as cnt '
	SET @Strsql+='LEFT OUTER JOIN tbl_master_designation desg ON desg.deg_id=cnt.emp_Designation WHERE cnt.emp_effectiveuntil IS NULL GROUP BY emp_cntId,desg.deg_designation,desg.deg_id) DESG ON DESG.emp_cntId=EMP.emp_contactId '
	SET @Strsql+='WHERE EMPCTC.emp_effectiveuntil IS NULL ) RPTTO ON RPTTO.emp_cntId=CNT.cnt_internalId '
	SET @Strsql+='INNER JOIN ( '
	SET @Strsql+='SELECT USERID,MIN(LOGGEDIN) AS LOGGEDIN,MAX(LOGEDOUT) AS LOGEDOUT,cnt_internalId,Login_datetime,MAX(ACTINTIME) AS ACTINTIME,MAX(ACTGRACEINTIME) AS ACTGRACEINTIME,MAX(ALTINTIME) AS ALTINTIME,'
	SET @Strsql+='MAX(ALTGRACEINTIME) AS ALTGRACEINTIME,MAX(ACTWORKTIME) AS ACTWORKTIME,MAX(ALTWORKTIME) AS ALTWORKTIME,ATTEN_STATUS FROM( '
	--Rev 1.0
	--SET @Strsql+='SELECT ATTEN.User_Id AS USERID,MIN(CONVERT(VARCHAR(15),CAST(ATTEN.Login_datetime AS TIME),100)) AS LOGGEDIN,NULL AS LOGEDOUT,CNT.cnt_internalId,'
	SET @Strsql+='SELECT ATTEN.User_Id AS USERID,MIN(CONVERT(VARCHAR(5),CAST(ATTEN.Login_datetime AS TIME),108)) AS LOGGEDIN,NULL AS LOGEDOUT,CNT.cnt_internalId,'
	--End of Rev 1.0
	SET @Strsql+='MAX(CONVERT(VARCHAR(15),CAST(EMPWHD.ACTINTIME AS TIME),100)) AS ACTINTIME,CONVERT(NVARCHAR(10),ATTEN.Work_datetime,105) AS Login_datetime,MAX(EMPWHD.ACTWORKTIME) AS ACTWORKTIME,'
	SET @Strsql+='MAX(CONVERT(VARCHAR(15),CAST(EMPWHD.ACTGRACEINTIME AS TIME),100)) AS ACTGRACEINTIME,MAX(CONVERT(VARCHAR(15),CAST(EMPWHD.ALTINTIME AS TIME),100)) AS ALTINTIME,MAX(EMPWHD.ALTWORKTIME) AS ALTWORKTIME,'
	SET @Strsql+='MAX(CONVERT(VARCHAR(15),CAST(EMPWHD.ALTGRACEINTIME AS TIME),100)) AS ALTGRACEINTIME,CASE WHEN Isonleave=''false'' THEN ''At Work'' ELSE ''On Leave'' END AS ATTEN_STATUS '
	SET @Strsql+='FROM tbl_fts_UserAttendanceLoginlogout ATTEN '
	SET @Strsql+='INNER JOIN tbl_master_user USR ON USR.user_id=ATTEN.User_Id AND USR.user_inactive=''N'' '
	SET @Strsql+='INNER JOIN #TEMPCONTACT CNT ON CNT.cnt_internalId=USR.user_contactId '
	SET @Strsql+='INNER JOIN tbl_trans_employeeCTC EMPCTC ON EMPCTC.emp_cntId=CNT.cnt_internalId '
	SET @Strsql+='INNER JOIN tbl_EmpWorkingHours EMPWH ON EMPWH.Id=EMPCTC.emp_workinghours '
	SET @Strsql+='INNER JOIN('
	SET @Strsql+='SELECT DISTINCT hourId,BeginTime AS ACTINTIME,CASE WHEN (CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (Grace))>0 '
	SET @Strsql+='THEN RIGHT(''0'' + CAST(CAST((CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (Grace)) AS VARCHAR)/ 60 AS VARCHAR),2)  + '':'' '
	SET @Strsql+='+RIGHT(''0'' + CAST(CAST((CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (Grace)) AS VARCHAR) % 60 AS VARCHAR),2) ELSE ''0'' END AS ACTGRACEINTIME,'
	SET @Strsql+='ALT_BeginTime AS ALTINTIME,CASE WHEN (CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ALT_BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ALT_BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (ALT_Grace))>0 '
	SET @Strsql+='THEN RIGHT(''0'' + CAST(CAST((CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ALT_BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ALT_BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (ALT_Grace)) AS VARCHAR)/ 60 AS VARCHAR),2)  + '':'' '
	SET @Strsql+='+RIGHT(''0'' + CAST(CAST((CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ALT_BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ALT_BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (ALT_Grace)) AS VARCHAR) % 60 AS VARCHAR),2) ELSE ''0'' END AS ALTGRACEINTIME,'
	SET @Strsql+='CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(EndTime,''00:00:00'')) * 60) AS FLOAT) + CAST(DATEPART(MINUTE,ISNULL(EndTime,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) - '
	SET @Strsql+='CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(BeginTime,''00:00:00'')) * 60) AS FLOAT) + CAST(DATEPART(MINUTE,ISNULL(BeginTime,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) AS ACTWORKTIME,'
	SET @Strsql+='CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(ALT_EndTime,''00:00:00'')) * 60) AS FLOAT) + CAST(DATEPART(MINUTE,ISNULL(ALT_EndTime,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) - '
	SET @Strsql+='CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(ALT_BeginTime,''00:00:00'')) * 60) AS FLOAT) + CAST(DATEPART(MINUTE,ISNULL(ALT_BeginTime,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) AS ALTWORKTIME '
	SET @Strsql+='FROM tbl_EmpWorkingHoursDetails) EMPWHD ON EMPWHD.hourId=EMPWH.Id '
	SET @Strsql+='WHERE CONVERT(NVARCHAR(10),ATTEN.Work_datetime,120) BETWEEN CONVERT(NVARCHAR(10),'''+@FROMDATE+''',120) AND CONVERT(NVARCHAR(10),'''+@TODATE+''',120) '
	SET @Strsql+='AND Login_datetime IS NOT NULL AND Logout_datetime IS NULL AND Isonleave=''false'' GROUP BY ATTEN.User_Id,CNT.cnt_internalId,CONVERT(NVARCHAR(10),ATTEN.Work_datetime,105),ATTEN.Isonleave '
	SET @Strsql+='UNION ALL '
	--Rev 1.0
	--SET @Strsql+='SELECT ATTEN.User_Id AS USERID,NULL AS LOGGEDIN,MAX(CONVERT(VARCHAR(15),CAST(ATTEN.Logout_datetime AS TIME),100)) AS LOGEDOUT,CNT.cnt_internalId,'
	SET @Strsql+='SELECT ATTEN.User_Id AS USERID,NULL AS LOGGEDIN,MAX(CONVERT(VARCHAR(5),CAST(ATTEN.Logout_datetime AS TIME),108)) AS LOGEDOUT,CNT.cnt_internalId,'
	--End of Rev 1.0
	SET @Strsql+='MAX(CONVERT(VARCHAR(15),CAST(EMPWHD.ACTINTIME AS TIME),100)) AS ACTINTIME,CONVERT(NVARCHAR(10),ATTEN.Work_datetime,105) AS Login_datetime,MAX(EMPWHD.ACTWORKTIME) AS ACTWORKTIME,'
	SET @Strsql+='MAX(CONVERT(VARCHAR(15),CAST(EMPWHD.ACTGRACEINTIME AS TIME),100)) AS ACTGRACEINTIME,MAX(CONVERT(VARCHAR(15),CAST(EMPWHD.ALTINTIME AS TIME),100)) AS ALTINTIME,MAX(EMPWHD.ALTWORKTIME) AS ALTWORKTIME,'
	SET @Strsql+='MAX(CONVERT(VARCHAR(15),CAST(EMPWHD.ALTGRACEINTIME AS TIME),100)) AS ALTGRACEINTIME,CASE WHEN Isonleave=''false'' THEN ''At Work'' ELSE ''On Leave'' END AS ATTEN_STATUS '
	SET @Strsql+='FROM tbl_fts_UserAttendanceLoginlogout ATTEN '
	SET @Strsql+='INNER JOIN tbl_master_user USR ON USR.user_id=ATTEN.User_Id AND USR.user_inactive=''N'' '
	SET @Strsql+='INNER JOIN #TEMPCONTACT CNT ON CNT.cnt_internalId=USR.user_contactId '
	SET @Strsql+='INNER JOIN tbl_trans_employeeCTC EMPCTC ON EMPCTC.emp_cntId=CNT.cnt_internalId '
	SET @Strsql+='INNER JOIN tbl_EmpWorkingHours EMPWH ON EMPWH.Id=EMPCTC.emp_workinghours '
	SET @Strsql+='INNER JOIN('
	SET @Strsql+='SELECT DISTINCT hourId,BeginTime AS ACTINTIME,CASE WHEN (CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (Grace))>0 '
	SET @Strsql+='THEN RIGHT(''0'' + CAST(CAST((CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (Grace)) AS VARCHAR)/ 60 AS VARCHAR),2)  + '':'' '
	SET @Strsql+='+RIGHT(''0'' + CAST(CAST((CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (Grace)) AS VARCHAR) % 60 AS VARCHAR),2) ELSE ''0'' END AS ACTGRACEINTIME,'
	SET @Strsql+='ALT_BeginTime AS ALTINTIME,CASE WHEN (CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ALT_BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ALT_BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (ALT_Grace))>0 '
	SET @Strsql+='THEN RIGHT(''0'' + CAST(CAST((CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ALT_BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ALT_BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (ALT_Grace)) AS VARCHAR)/ 60 AS VARCHAR),2)  + '':'' '
	SET @Strsql+='+RIGHT(''0'' + CAST(CAST((CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ALT_BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ALT_BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (ALT_Grace)) AS VARCHAR) % 60 AS VARCHAR),2) ELSE ''0'' END AS ALTGRACEINTIME,'
	SET @Strsql+='CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(EndTime,''00:00:00'')) * 60) AS FLOAT) + CAST(DATEPART(MINUTE,ISNULL(EndTime,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) - '
	SET @Strsql+='CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(BeginTime,''00:00:00'')) * 60) AS FLOAT) + CAST(DATEPART(MINUTE,ISNULL(BeginTime,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) AS ACTWORKTIME,'
	SET @Strsql+='CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(ALT_EndTime,''00:00:00'')) * 60) AS FLOAT) + CAST(DATEPART(MINUTE,ISNULL(ALT_EndTime,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) - '
	SET @Strsql+='CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(ALT_BeginTime,''00:00:00'')) * 60) AS FLOAT) + CAST(DATEPART(MINUTE,ISNULL(ALT_BeginTime,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) AS ALTWORKTIME '
	SET @Strsql+='FROM tbl_EmpWorkingHoursDetails) EMPWHD ON EMPWHD.hourId=EMPWH.Id '
	SET @Strsql+='WHERE CONVERT(NVARCHAR(10),ATTEN.Work_datetime,120) BETWEEN CONVERT(NVARCHAR(10),'''+@FROMDATE+''',120) AND CONVERT(NVARCHAR(10),'''+@TODATE+''',120) '
	SET @Strsql+='AND Login_datetime IS NULL AND Logout_datetime IS NOT NULL AND Isonleave=''false'' '
	SET @Strsql+='GROUP BY ATTEN.User_Id,CNT.cnt_internalId,CONVERT(NVARCHAR(10),ATTEN.Work_datetime,105),ATTEN.Isonleave '
	SET @Strsql+=') LOGINLOGOUT GROUP BY USERID,cnt_internalId,Login_datetime,ATTEN_STATUS) ATTEN ON ATTEN.cnt_internalId=CNT.cnt_internalId AND ATTEN.USERID=USR.user_id '
	SET @Strsql+='LEFT OUTER JOIN ('
	--Rev 2.0
	--SET @Strsql+='SELECT User_Id,cnt_internalId,SUM(NEWSHOP_VISITED) AS NEWSHOP_VISITED,SUM(RE_VISITED) AS RE_VISITED,MIN(CONVERT(VARCHAR(15),CAST(FCALLTIME AS TIME),100)) AS FIRSTCALLTIME,'
	--SET @Strsql+='MAX(CONVERT(VARCHAR(15),CAST(LCALLTIME AS TIME),100)) AS LASTCALLTIME,CONVERT(NVARCHAR(10),VISITED_TIME,105) AS VISITED_TIME FROM('
	--SET @Strsql+='SELECT SHOPACT.User_Id,CNT.cnt_internalId,COUNT(SHOPACT.Shop_Id) AS NEWSHOP_VISITED,0 AS RE_VISITED,CAST(SHOPACT.visited_time AS DATE) AS visited_time,MIN(visited_time) AS FCALLTIME,'
	--SET @Strsql+='MAX(visited_time) AS LCALLTIME '
	SET @Strsql+='SELECT User_Id,cnt_internalId,SUM(NEWSHOP_VISITED) AS NEWSHOP_VISITED,SUM(RE_VISITED) AS RE_VISITED,SUM(TOTMETTING) AS TOTMETTING,'
	SET @Strsql+='MIN(CONVERT(VARCHAR(5),CAST(FCALLTIME AS TIME),108)) AS FIRSTCALLTIME,MAX(CONVERT(VARCHAR(5),CAST(LCALLTIME AS TIME),108)) AS LASTCALLTIME,'
	SET @Strsql+='CONVERT(NVARCHAR(10),VISITED_TIME,105) AS VISITED_TIME FROM('
	SET @Strsql+='SELECT SHOPACT.User_Id,CNT.cnt_internalId,COUNT(SHOPACT.Shop_Id) AS NEWSHOP_VISITED,0 AS RE_VISITED,0 AS TOTMETTING,CAST(SHOPACT.visited_time AS DATE) AS visited_time,'
	SET @Strsql+='MIN(visited_time) AS FCALLTIME,MAX(visited_time) AS LCALLTIME '
	--End of Rev 2.0
	SET @Strsql+='FROM tbl_trans_shopActivitysubmit SHOPACT '
	SET @Strsql+='INNER JOIN tbl_master_user USR ON USR.user_id=SHOPACT.User_Id '
	SET @Strsql+='INNER JOIN #TEMPCONTACT CNT ON CNT.cnt_internalId=USR.user_contactId '
	SET @Strsql+='WHERE CONVERT(NVARCHAR(10),SHOPACT.visited_time,120) BETWEEN CONVERT(NVARCHAR(10),'''+@FROMDATE+''',120) AND CONVERT(NVARCHAR(10),'''+@TODATE+''',120) '
	SET @Strsql+='AND SHOPACT.Is_Newshopadd=1 '
	SET @Strsql+='GROUP BY SHOPACT.User_Id,CNT.cnt_internalId,CAST(SHOPACT.visited_time AS DATE) '
	SET @Strsql+='UNION ALL '
	--Rev 2.0
	--SET @Strsql+='SELECT SHOPACT.User_Id,CNT.cnt_internalId,0 AS NEWSHOP_VISITED,COUNT(SHOPACT.Shop_Id) AS RE_VISITED,CAST(SHOPACT.visited_time AS DATE) AS visited_time,MIN(visited_time) AS FCALLTIME,'
	--SET @Strsql+='MAX(visited_time) AS LCALLTIME '
	SET @Strsql+='SELECT SHOPACT.User_Id,CNT.cnt_internalId,0 AS NEWSHOP_VISITED,COUNT(SHOPACT.Shop_Id) AS RE_VISITED,0 AS TOTMETTING,CAST(SHOPACT.visited_time AS DATE) AS visited_time,'
	SET @Strsql+='MIN(visited_time) AS FCALLTIME,MAX(visited_time) AS LCALLTIME '
	--End of Rev 2.0
	SET @Strsql+='FROM tbl_trans_shopActivitysubmit SHOPACT '
	SET @Strsql+='INNER JOIN tbl_master_user USR ON USR.user_id=SHOPACT.User_Id '
	SET @Strsql+='INNER JOIN #TEMPCONTACT CNT ON CNT.cnt_internalId=USR.user_contactId '	
	SET @Strsql+='WHERE CONVERT(NVARCHAR(10),SHOPACT.visited_time,120) BETWEEN CONVERT(NVARCHAR(10),'''+@FROMDATE+''',120) AND CONVERT(NVARCHAR(10),'''+@TODATE+''',120) '
	SET @Strsql+='AND SHOPACT.Is_Newshopadd=0 AND SHOPACT.ISMEETING=0 '
	SET @Strsql+='GROUP BY SHOPACT.User_Id,CNT.cnt_internalId,CAST(SHOPACT.visited_time AS DATE) '
	--Rev 2.0
	--MEETING
	SET @Strsql+='UNION ALL '
	SET @Strsql+='SELECT SHOPACT.User_Id,CNT.cnt_internalId,0 AS NEWSHOP_VISITED,0 AS RE_VISITED,COUNT(SHOPACT.Shop_Id) AS TOTMETTING,CAST(SHOPACT.visited_time AS DATE) AS visited_time,'
	SET @Strsql+='MIN(visited_time) AS FCALLTIME,MAX(visited_time) AS LCALLTIME '
	SET @Strsql+='FROM tbl_trans_shopActivitysubmit SHOPACT '
	SET @Strsql+='INNER JOIN tbl_master_user USR ON USR.user_id=SHOPACT.User_Id '
	SET @Strsql+='INNER JOIN #TEMPCONTACT CNT ON CNT.cnt_internalId=USR.user_contactId '
	SET @Strsql+='WHERE ISMEETING=1 AND MEETING_TYPEID IS NOT NULL '
	SET @Strsql+='AND CONVERT(NVARCHAR(10),SHOPACT.visited_time,120) BETWEEN CONVERT(NVARCHAR(10),'''+@FROMDATE+''',120) AND CONVERT(NVARCHAR(10),'''+@TODATE+''',120) '
	SET @Strsql+='GROUP BY SHOPACT.User_Id,CNT.cnt_internalId,CAST(SHOPACT.visited_time AS DATE) '
	--End of Rev 2.0
	SET @Strsql+=') AA GROUP BY User_Id,cnt_internalId,CAST(VISITED_TIME AS DATE)) SHOPACT ON SHOPACT.cnt_internalId=CNT.cnt_internalId AND ATTEN.Login_datetime=SHOPACT.VISITED_TIME '
	--Rev 2.0
	----MEETING
	--SET @Strsql+='LEFT OUTER JOIN ('
	--SET @Strsql+='SELECT User_Id,cnt_internalId,CONVERT(NVARCHAR(10),VISITED_TIME,105) AS VISITED_TIME,SUM(TOTMETTING) AS TOTMETTING FROM('
	--SET @Strsql+='SELECT SHOPACT.User_Id,CNT.cnt_internalId,COUNT(SHOPACT.Shop_Id) AS TOTMETTING,CAST(SHOPACT.visited_time AS DATE) AS visited_time '
	--SET @Strsql+='FROM tbl_trans_shopActivitysubmit SHOPACT '
	--SET @Strsql+='INNER JOIN tbl_master_user USR ON USR.user_id=SHOPACT.User_Id '
	--SET @Strsql+='INNER JOIN #TEMPCONTACT CNT ON CNT.cnt_internalId=USR.user_contactId '
	--SET @Strsql+='WHERE ISMEETING=1 AND MEETING_TYPEID IS NOT NULL '
	--SET @Strsql+='AND CONVERT(NVARCHAR(10),SHOPACT.visited_time,120) BETWEEN CONVERT(NVARCHAR(10),'''+@FROMDATE+''',120) AND CONVERT(NVARCHAR(10),'''+@TODATE+''',120) '
	--SET @Strsql+='GROUP BY SHOPACT.User_Id,CNT.cnt_internalId,CAST(SHOPACT.visited_time AS DATE) '
	--SET @Strsql+=') AA GROUP BY User_Id,cnt_internalId,CAST(VISITED_TIME AS DATE) '
	--SET @Strsql+=') MEET ON MEET.cnt_internalId=CNT.cnt_internalId AND ATTEN.Login_datetime=MEET.VISITED_TIME '
	--End of Rev 2.0
	--LOCAL/OUTSTATION
	SET @Strsql+='LEFT OUTER JOIN ('
	SET @Strsql+='SELECT User_Id,cnt_internalId,CONVERT(NVARCHAR(10),VISITED_TIME,105) AS VISITED_TIME,ATTENDANCETYPE FROM('
	SET @Strsql+='SELECT SHOPACT.User_Id,CNT.cnt_internalId,CASE WHEN IsOutStation=0 THEN ''Local'' ELSE ''Outstation'' END AS ATTENDANCETYPE,CAST(SHOPACT.visited_time AS DATE) AS visited_time '
	SET @Strsql+='FROM tbl_trans_shopActivitysubmit SHOPACT '
	SET @Strsql+='INNER JOIN tbl_master_user USR ON USR.user_id=SHOPACT.User_Id '
	SET @Strsql+='INNER JOIN tbl_master_contact CNT ON CNT.cnt_internalId=USR.user_contactId '
	SET @Strsql+='WHERE IsFirstVisit=1 '
	SET @Strsql+='AND CONVERT(NVARCHAR(10),SHOPACT.visited_time,120) BETWEEN CONVERT(NVARCHAR(10),'''+@FROMDATE+''',120) AND CONVERT(NVARCHAR(10),'''+@TODATE+''',120) '
	SET @Strsql+='GROUP BY SHOPACT.User_Id,CNT.cnt_internalId,IsOutStation,CAST(SHOPACT.visited_time AS DATE) '
	SET @Strsql+=') AA GROUP BY User_Id,cnt_internalId,ATTENDANCETYPE,CAST(VISITED_TIME AS DATE) '
	SET @Strsql+=') LOCALOUTST ON LOCALOUTST.cnt_internalId=CNT.cnt_internalId AND ATTEN.Login_datetime=LOCALOUTST.VISITED_TIME '
	SET @Strsql+='LEFT OUTER JOIN (SELECT GPS.User_Id,CNT.cnt_internalId,CONVERT(NVARCHAR(10),GPS.GPsDate,105) AS GPsDate,COUNT(GPS.Gps_OffTime) AS GPSINACTIVECNT,'
	SET @Strsql+='CAST(ISNULL(CAST((SUM(DATEPART(HOUR,ISNULL(GPS.Duration,''00:00:00'')) * 60)) AS FLOAT) +CAST(SUM(DATEPART(MINUTE,ISNULL(GPS.Duration,''00:00:00'')) * 1) AS FLOAT),0) AS VARCHAR(100)) AS GPS_Inactive_duration '
	SET @Strsql+='FROM tbl_FTS_GPSSubmission GPS '
	SET @Strsql+='INNER JOIN tbl_master_user USR ON USR.user_id=GPS.User_Id '
	SET @Strsql+='INNER JOIN #TEMPCONTACT CNT ON CNT.cnt_internalId=USR.user_contactId '
	SET @Strsql+='WHERE CONVERT(NVARCHAR(10),GPS.GPsDate,120) BETWEEN CONVERT(NVARCHAR(10),'''+@FROMDATE+''',120) AND CONVERT(NVARCHAR(10),'''+@TODATE+''',120) '
	SET @Strsql+='GROUP BY GPS.User_Id,CNT.cnt_internalId,GPS.GPsDate) GPSSM ON GPSSM.cnt_internalId=CNT.cnt_internalId AND ATTEN.Login_datetime=GPSSM.GPsDate '
	SET @Strsql+='LEFT OUTER JOIN ('
	SET @Strsql+='SELECT user_id,SUM(IDEAL_TIME) AS IDEAL_TIME,CONVERT(NVARCHAR(10),start_ideal_date_time,105) AS start_ideal_date_time FROM('
	SET @Strsql+='SELECT user_id,CAST(start_ideal_date_time AS DATE) start_ideal_date_time,'	
	SET @Strsql+='CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(end_ideal_date_time,''00:00:00'')) * 60) AS FLOAT) + CAST(DATEPART(MINUTE,ISNULL(end_ideal_date_time,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) - '
	SET @Strsql+='CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(start_ideal_date_time,''00:00:00'')) * 60) AS FLOAT) + CAST(DATEPART(MINUTE,ISNULL(start_ideal_date_time,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) AS IDEAL_TIME '
	SET @Strsql+='FROM FTS_Ideal_Loaction WHERE CONVERT(NVARCHAR(10),start_ideal_date_time,120) BETWEEN CONVERT(NVARCHAR(10),'''+@FROMDATE+''',120) AND CONVERT(NVARCHAR(10),'''+@TODATE+''',120) '
	SET @Strsql+=') IDLE GROUP BY user_id,start_ideal_date_time) IDEALLOACTION ON IDEALLOACTION.user_id=USR.user_id AND ATTEN.Login_datetime=IDEALLOACTION.start_ideal_date_time '
	SET @Strsql+='LEFT OUTER JOIN ('
	SET @Strsql+='SELECT SUM(PJPCNT) AS PJPCNT,cnt_internalId,CONVERT(NVARCHAR(10),PJP_Date,105) AS PJP_Date FROM('
	SET @Strsql+='SELECT COUNT(PJP.User_Id) AS PJPCNT,CNT.cnt_internalId,CAST(PJP.PJP_Date AS DATE) AS PJP_Date '
	SET @Strsql+='FROM FTS_PJPPlanDetails PJP '
	SET @Strsql+='INNER JOIN tbl_master_user USR ON USR.user_id=PJP.User_Id '
	SET @Strsql+='INNER JOIN #TEMPCONTACT CNT ON CNT.cnt_internalId=USR.user_contactId '
	SET @Strsql+='WHERE CONVERT(NVARCHAR(10),PJP.PJP_Date,120) BETWEEN CONVERT(NVARCHAR(10),'''+@FROMDATE+''',120) AND CONVERT(NVARCHAR(10),'''+@TODATE+''',120) '
	SET @Strsql+='GROUP BY CNT.cnt_internalId,CAST(PJP.PJP_Date AS DATE)) PJP GROUP BY cnt_internalId,CAST(PJP_Date AS DATE)) PJPDET ON PJPDET.cnt_internalId=CNT.cnt_internalId AND ATTEN.Login_datetime=PJPDET.PJP_Date '
	SET @Strsql+='LEFT OUTER JOIN (SELECT ORDH.userID,CNT.cnt_internalId,SUM(ISNULL(Ordervalue,0)) AS Ordervalue,COUNT(ORDH.SHOP_CODE) AS ORDCNT,CONVERT(NVARCHAR(10),ORDH.Orderdate,105) AS ORDDATE '
	SET @Strsql+='FROM tbl_trans_fts_Orderupdate ORDH '
	SET @Strsql+='INNER JOIN tbl_master_user USR ON USR.user_id=ORDH.userID '
	SET @Strsql+='INNER JOIN #TEMPCONTACT CNT ON CNT.cnt_internalId=USR.user_contactId '
	SET @Strsql+='WHERE CONVERT(NVARCHAR(10),ORDH.Orderdate,120) BETWEEN CONVERT(NVARCHAR(10),'''+@FROMDATE+''',120) AND CONVERT(NVARCHAR(10),'''+@TODATE+''',120) '
	SET @Strsql+='GROUP BY ORDH.userID,CNT.cnt_internalId,CONVERT(NVARCHAR(10),ORDH.Orderdate,105)) ORDHEAD ON ORDHEAD.cnt_internalId=CNT.cnt_internalId AND ATTEN.Login_datetime=ORDHEAD.ORDDATE '
	SET @Strsql+='LEFT OUTER JOIN (SELECT BH.User_Id,CNT.cnt_internalId,SUM(ISNULL(BH.invoice_amount,0)) AS Invvalue,CONVERT(NVARCHAR(10),BH.invoice_date,105) AS INVDATE FROM tbl_FTS_BillingDetails BH '
	SET @Strsql+='INNER JOIN tbl_master_user USR ON USR.user_id=BH.User_Id '
	SET @Strsql+='INNER JOIN #TEMPCONTACT CNT ON CNT.cnt_internalId=USR.user_contactId '
	SET @Strsql+='INNER JOIN tbl_trans_fts_Orderupdate OH ON OH.OrderCode=BH.OrderCode '
	SET @Strsql+='WHERE CONVERT(NVARCHAR(10),BH.invoice_date,120) BETWEEN CONVERT(NVARCHAR(10),'''+@FROMDATE+''',120) AND CONVERT(NVARCHAR(10),'''+@TODATE+''',120) '
	SET @Strsql+='GROUP BY BH.User_Id,CNT.cnt_internalId,CONVERT(NVARCHAR(10),BH.invoice_date,105)) BH ON BH.cnt_internalId=CNT.cnt_internalId AND ATTEN.Login_datetime=BH.INVDATE '	
	SET @Strsql+='LEFT OUTER JOIN (SELECT COLLEC.user_id,CNT.cnt_internalId,SUM(ISNULL(COLLEC.collection,0)) AS collectionvalue,CONVERT(NVARCHAR(10),COLLEC.collection_date,105) AS collection_date '
	SET @Strsql+='FROM tbl_FTS_collection COLLEC '
	SET @Strsql+='INNER JOIN tbl_master_user USR ON USR.user_id=COLLEC.user_id '
	SET @Strsql+='INNER JOIN #TEMPCONTACT CNT ON CNT.cnt_internalId=USR.user_contactId '
	SET @Strsql+='WHERE CONVERT(NVARCHAR(10),COLLEC.collection_date,120) BETWEEN CONVERT(NVARCHAR(10),'''+@FROMDATE+''',120) AND CONVERT(NVARCHAR(10),'''+@TODATE+''',120) '
	SET @Strsql+='GROUP BY COLLEC.user_id,CNT.cnt_internalId,CONVERT(NVARCHAR(10),COLLEC.collection_date,105)) COLLEC ON COLLEC.cnt_internalId=CNT.cnt_internalId AND ATTEN.Login_datetime=COLLEC.collection_date '
	SET @Strsql+='UNION ALL '
	SET @Strsql+='SELECT CNT.cnt_internalId AS EMPCODE,ISNULL(CNT.CNT_FIRSTNAME,'''')+'' ''+ISNULL(CNT.CNT_MIDDLENAME,'''')+'' ''+ISNULL(CNT.CNT_LASTNAME,'''') AS EMPNAME,ISNULL(ST.ID,0) AS STATEID,'
	SET @Strsql+='ISNULL(ST.state,''State Undefined'') AS STATE,DESG.DEG_ID,DESG.deg_designation AS DESIGNATION,CONVERT(NVARCHAR(10),EMP.emp_dateofJoining,105) AS DATEOFJOINING,USR.user_loginId AS CONTACTNO,'
	--Rev 1.0
	--SET @Strsql+='RPTTO.REPORTTO,RPTTO.RPTTODESG,LOGIN_DATETIME,REPLACE(REPLACE(LOGGEDIN,''AM'','' AM''),''PM'','' PM'') AS APPLOGGEDIN,REPLACE(REPLACE(LOGEDOUT,''AM'','' AM''),''PM'','' PM'') AS APPLOGEDOUT,'
	SET @Strsql+='RPTTO.REPORTTO,RPTTO.RPTTODESG,LOGIN_DATETIME,ATTEN.LOGGEDIN AS APPLOGGEDIN,ATTEN.LOGEDOUT AS APPLOGEDOUT,'
	--End of Rev 1.0
	SET @Strsql+='ADDR.add_address1+'' ''+ISNULL(ADDR.add_address2,'''')+'' ''+ISNULL(ADDR.add_address3,'''') AS OFFICE_ADDRESS,EMP.emp_uniqueCode AS EMPID,ATTEN_STATUS,'
	SET @Strsql+='(SELECT DISTINCT ISNULL(STUFF((SELECT '','' + LTRIM(RTRIM(LTYP.LeaveType)) From tbl_fts_UserAttendanceLoginlogout AS ATTEN '
	SET @Strsql+='INNER JOIN tbl_master_user MUSR ON MUSR.USER_ID=ATTEN.USER_ID AND MUSR.user_inactive=''N'' AND MUSR.USER_ID=USR.USER_ID '
	SET @Strsql+='INNER JOIN tbl_FTS_Leavetype LTYP ON LTYP.Leave_Id=ATTEN.Leave_Type '
	SET @Strsql+='WHERE CONVERT(NVARCHAR(10),ATTEN.Work_datetime,120) BETWEEN CONVERT(NVARCHAR(10),'''+@FROMDATE+''',120) AND CONVERT(NVARCHAR(10),'''+@TODATE+''',120) '
	SET @Strsql+='AND Login_datetime IS NOT NULL AND Logout_datetime IS NULL AND Isonleave=''true'' '
	SET @Strsql+='GROUP BY LTYP.LeaveType FOR XML PATH('''')), 1, 1, ''''),'''')) AS WORK_LEAVE_TYPE,'''' AS REMARKS,REPLACE(REPLACE(ATTEN.ACTINTIME,''AM'','' AM''),''PM'','' PM'') AS ACTINTIME,'
	SET @Strsql+='REPLACE(REPLACE(ATTEN.ACTGRACEINTIME,''AM'','' AM''),''PM'','' PM'') AS ACTGRACEINTIME,REPLACE(REPLACE(ATTEN.ALTINTIME,''AM'','' AM''),''PM'','' PM'') AS ALTINTIME,'
	SET @Strsql+='REPLACE(REPLACE(ATTEN.ALTGRACEINTIME,''AM'','' AM''),''PM'','' PM'') AS ALTGRACEINTIME,NULL AS FIRSTCALLTIME,NULL AS LASTCALLTIME,NULL AS ATTENDANCETYPE,''On Leave'' AS ATTENDANCESTATUS,'
	SET @Strsql+='NULL WORKINGDURATION,NULL AS UNDERTIME,NULL AS GPS_INACTIVE_DURATION,0 AS GPSINACTIVECNT,NULL AS IDEAL_TIME,0 AS IDEALTIME_CNT,0 AS TOTMETTING,0 AS TC,0 AS PC,0 AS PJPCNT,0 AS NEWSHOP_VISITED,'
	SET @Strsql+='0 AS RE_VISITED,0.00 AS TOTALORDER,0.00 AS TOTALDELV,0.00 AS TOTALCOLLECTION FROM tbl_master_employee EMP '
	SET @Strsql+='INNER JOIN #TEMPCONTACT CNT ON CNT.cnt_internalId=EMP.emp_contactId '
	SET @Strsql+='INNER JOIN tbl_master_user USR ON USR.user_contactId=EMP.emp_contactId AND USR.user_inactive=''N'' '
	SET @Strsql+='LEFT OUTER JOIN tbl_master_address ADDR ON ADDR.add_cntId=CNT.cnt_internalid AND ADDR.add_addressType=''Office'' '
	SET @Strsql+='LEFT OUTER JOIN tbl_master_state ST ON ST.id=ADDR.add_state '
	SET @Strsql+='INNER JOIN ( '
	SET @Strsql+='SELECT cnt.emp_cntId,desg.deg_designation,MAX(emp_id) as emp_id,desg.deg_id FROM tbl_trans_employeeCTC as cnt '
	SET @Strsql+='LEFT OUTER JOIN tbl_master_designation desg ON desg.deg_id=cnt.emp_Designation WHERE cnt.emp_effectiveuntil IS NULL GROUP BY emp_cntId,desg.deg_designation,desg.deg_id) DESG ON DESG.emp_cntId=EMP.emp_contactId '
	SET @Strsql+='LEFT OUTER JOIN (SELECT EMPCTC.emp_cntId,EMPCTC.emp_reportTo,CNT.cnt_internalId,ISNULL(CNT.CNT_FIRSTNAME,'''')+'' ''+ISNULL(CNT.CNT_MIDDLENAME,'''')+'' ''+ISNULL(CNT.CNT_LASTNAME,'''') AS REPORTTO,'
	SET @Strsql+='DESG.deg_designation AS RPTTODESG FROM tbl_master_employee EMP '
	SET @Strsql+='INNER JOIN tbl_trans_employeeCTC EMPCTC ON EMP.emp_id=EMPCTC.emp_reportTo '
	SET @Strsql+='INNER JOIN #TEMPCONTACT CNT ON CNT.cnt_internalId=EMP.emp_contactId '
	SET @Strsql+='INNER JOIN ( '
	SET @Strsql+='SELECT cnt.emp_cntId,desg.deg_designation,MAX(emp_id) as emp_id,desg.deg_id FROM tbl_trans_employeeCTC as cnt '
	SET @Strsql+='LEFT OUTER JOIN tbl_master_designation desg ON desg.deg_id=cnt.emp_Designation WHERE cnt.emp_effectiveuntil IS NULL GROUP BY emp_cntId,desg.deg_designation,desg.deg_id) DESG ON DESG.emp_cntId=EMP.emp_contactId '
	SET @Strsql+='WHERE EMPCTC.emp_effectiveuntil IS NULL ) RPTTO ON RPTTO.emp_cntId=CNT.cnt_internalId '
	SET @Strsql+='INNER JOIN ( '
	SET @Strsql+='SELECT USERID,MIN(LOGGEDIN) AS LOGGEDIN,MAX(LOGEDOUT) AS LOGEDOUT,cnt_internalId,Login_datetime,MAX(ACTINTIME) AS ACTINTIME,MAX(ACTGRACEINTIME) AS ACTGRACEINTIME,MAX(ALTINTIME) AS ALTINTIME,'
	SET @Strsql+='MAX(ALTGRACEINTIME) AS ALTGRACEINTIME,MAX(ACTWORKTIME) AS ACTWORKTIME,MAX(ALTWORKTIME) AS ALTWORKTIME,ATTEN_STATUS FROM( '
	--Rev 1.0
	--SET @Strsql+='SELECT ATTEN.User_Id AS USERID,MIN(CONVERT(VARCHAR(15),CAST(ATTEN.Login_datetime AS TIME),100)) AS LOGGEDIN,NULL AS LOGEDOUT,CNT.cnt_internalId,'
	SET @Strsql+='SELECT ATTEN.User_Id AS USERID,MIN(CONVERT(VARCHAR(5),CAST(ATTEN.Login_datetime AS TIME),108)) AS LOGGEDIN,NULL AS LOGEDOUT,CNT.cnt_internalId,'
	--End of Rev 1.0
	SET @Strsql+='MAX(CONVERT(VARCHAR(15),CAST(EMPWHD.ACTINTIME AS TIME),100)) AS ACTINTIME,CONVERT(NVARCHAR(10),ATTEN.Work_datetime,105) AS Login_datetime,MAX(EMPWHD.ACTWORKTIME) AS ACTWORKTIME,'
	SET @Strsql+='MAX(CONVERT(VARCHAR(15),CAST(EMPWHD.ACTGRACEINTIME AS TIME),100)) AS ACTGRACEINTIME,MAX(CONVERT(VARCHAR(15),CAST(EMPWHD.ALTINTIME AS TIME),100)) AS ALTINTIME,MAX(EMPWHD.ALTWORKTIME) AS ALTWORKTIME,'
	SET @Strsql+='MAX(CONVERT(VARCHAR(15),CAST(EMPWHD.ALTGRACEINTIME AS TIME),100)) AS ALTGRACEINTIME,CASE WHEN Isonleave=''false'' THEN ''At Work'' ELSE ''On Leave'' END AS ATTEN_STATUS '
	SET @Strsql+='FROM tbl_fts_UserAttendanceLoginlogout ATTEN '
	SET @Strsql+='INNER JOIN tbl_master_user USR ON USR.user_id=ATTEN.User_Id AND USR.user_inactive=''N'' '
	SET @Strsql+='INNER JOIN #TEMPCONTACT CNT ON CNT.cnt_internalId=USR.user_contactId '
	SET @Strsql+='INNER JOIN tbl_trans_employeeCTC EMPCTC ON EMPCTC.emp_cntId=CNT.cnt_internalId '
	SET @Strsql+='INNER JOIN tbl_EmpWorkingHours EMPWH ON EMPWH.Id=EMPCTC.emp_workinghours '
	SET @Strsql+='INNER JOIN('
	SET @Strsql+='SELECT DISTINCT hourId,BeginTime AS ACTINTIME,CASE WHEN (CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (Grace))>0 '
	SET @Strsql+='THEN RIGHT(''0'' + CAST(CAST((CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (Grace)) AS VARCHAR)/ 60 AS VARCHAR),2)  + '':'' '
	SET @Strsql+='+RIGHT(''0'' + CAST(CAST((CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (Grace)) AS VARCHAR) % 60 AS VARCHAR),2) ELSE ''0'' END AS ACTGRACEINTIME,'
	SET @Strsql+='ALT_BeginTime AS ALTINTIME,CASE WHEN (CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ALT_BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ALT_BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (ALT_Grace))>0 '
	SET @Strsql+='THEN RIGHT(''0'' + CAST(CAST((CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ALT_BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ALT_BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (ALT_Grace)) AS VARCHAR)/ 60 AS VARCHAR),2)  + '':'' '
	SET @Strsql+='+RIGHT(''0'' + CAST(CAST((CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ALT_BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ALT_BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (ALT_Grace)) AS VARCHAR) % 60 AS VARCHAR),2) ELSE ''0'' END AS ALTGRACEINTIME,'
	SET @Strsql+='CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(EndTime,''00:00:00'')) * 60) AS FLOAT) + CAST(DATEPART(MINUTE,ISNULL(EndTime,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) - '
	SET @Strsql+='CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(BeginTime,''00:00:00'')) * 60) AS FLOAT) + CAST(DATEPART(MINUTE,ISNULL(BeginTime,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) AS ACTWORKTIME,'
	SET @Strsql+='CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(ALT_EndTime,''00:00:00'')) * 60) AS FLOAT) + CAST(DATEPART(MINUTE,ISNULL(ALT_EndTime,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) - '
	SET @Strsql+='CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(ALT_BeginTime,''00:00:00'')) * 60) AS FLOAT) + CAST(DATEPART(MINUTE,ISNULL(ALT_BeginTime,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) AS ALTWORKTIME '
	SET @Strsql+='FROM tbl_EmpWorkingHoursDetails) EMPWHD ON EMPWHD.hourId=EMPWH.Id '
	SET @Strsql+='WHERE CONVERT(NVARCHAR(10),ATTEN.Work_datetime,120) BETWEEN CONVERT(NVARCHAR(10),'''+@FROMDATE+''',120) AND CONVERT(NVARCHAR(10),'''+@TODATE+''',120) '
	SET @Strsql+='AND Login_datetime IS NOT NULL AND Logout_datetime IS NULL AND Isonleave=''true'' GROUP BY ATTEN.User_Id,CNT.cnt_internalId,CONVERT(NVARCHAR(10),ATTEN.Work_datetime,105),ATTEN.Isonleave '
	SET @Strsql+='UNION ALL '
	--Rev 1.0
	--SET @Strsql+='SELECT ATTEN.User_Id AS USERID,NULL AS LOGGEDIN,MAX(CONVERT(VARCHAR(15),CAST(ATTEN.Logout_datetime AS TIME),100)) AS LOGEDOUT,CNT.cnt_internalId,'
	SET @Strsql+='SELECT ATTEN.User_Id AS USERID,NULL AS LOGGEDIN,MAX(CONVERT(VARCHAR(5),CAST(ATTEN.Logout_datetime AS TIME),108)) AS LOGEDOUT,CNT.cnt_internalId,'
	--End of Rev 1.0
	SET @Strsql+='MAX(CONVERT(VARCHAR(15),CAST(EMPWHD.ACTINTIME AS TIME),100)) AS ACTINTIME,CONVERT(NVARCHAR(10),ATTEN.Work_datetime,105) AS Login_datetime,MAX(EMPWHD.ACTWORKTIME) AS ACTWORKTIME,'
	SET @Strsql+='MAX(CONVERT(VARCHAR(15),CAST(EMPWHD.ACTGRACEINTIME AS TIME),100)) AS ACTGRACEINTIME,MAX(CONVERT(VARCHAR(15),CAST(EMPWHD.ALTINTIME AS TIME),100)) AS ALTINTIME,MAX(EMPWHD.ALTWORKTIME) AS ALTWORKTIME,'
	SET @Strsql+='MAX(CONVERT(VARCHAR(15),CAST(EMPWHD.ALTGRACEINTIME AS TIME),100)) AS ALTGRACEINTIME,CASE WHEN Isonleave=''false'' THEN ''At Work'' ELSE ''On Leave'' END AS ATTEN_STATUS '
	SET @Strsql+='FROM tbl_fts_UserAttendanceLoginlogout ATTEN '
	SET @Strsql+='INNER JOIN tbl_master_user USR ON USR.user_id=ATTEN.User_Id AND USR.user_inactive=''N'' '
	SET @Strsql+='INNER JOIN #TEMPCONTACT CNT ON CNT.cnt_internalId=USR.user_contactId '
	SET @Strsql+='INNER JOIN tbl_trans_employeeCTC EMPCTC ON EMPCTC.emp_cntId=CNT.cnt_internalId '
	SET @Strsql+='INNER JOIN tbl_EmpWorkingHours EMPWH ON EMPWH.Id=EMPCTC.emp_workinghours '
	SET @Strsql+='INNER JOIN('
	SET @Strsql+='SELECT DISTINCT hourId,BeginTime AS ACTINTIME,CASE WHEN (CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (Grace))>0 '
	SET @Strsql+='THEN RIGHT(''0'' + CAST(CAST((CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (Grace)) AS VARCHAR)/ 60 AS VARCHAR),2)  + '':'' '
	SET @Strsql+='+RIGHT(''0'' + CAST(CAST((CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (Grace)) AS VARCHAR) % 60 AS VARCHAR),2) ELSE ''0'' END AS ACTGRACEINTIME,'
	SET @Strsql+='ALT_BeginTime AS ALTINTIME,CASE WHEN (CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ALT_BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ALT_BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (ALT_Grace))>0 '
	SET @Strsql+='THEN RIGHT(''0'' + CAST(CAST((CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ALT_BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ALT_BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (ALT_Grace)) AS VARCHAR)/ 60 AS VARCHAR),2)  + '':'' '
	SET @Strsql+='+RIGHT(''0'' + CAST(CAST((CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL((ALT_BeginTime),''00:00:00'')) * 60) AS FLOAT) + '
	SET @Strsql+='CAST(DATEPART(MINUTE,ISNULL((ALT_BeginTime),''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) + (ALT_Grace)) AS VARCHAR) % 60 AS VARCHAR),2) ELSE ''0'' END AS ALTGRACEINTIME,'
	SET @Strsql+='CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(EndTime,''00:00:00'')) * 60) AS FLOAT) + CAST(DATEPART(MINUTE,ISNULL(EndTime,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) - '
	SET @Strsql+='CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(BeginTime,''00:00:00'')) * 60) AS FLOAT) + CAST(DATEPART(MINUTE,ISNULL(BeginTime,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) AS ACTWORKTIME,'
	SET @Strsql+='CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(ALT_EndTime,''00:00:00'')) * 60) AS FLOAT) + CAST(DATEPART(MINUTE,ISNULL(ALT_EndTime,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) - '
	SET @Strsql+='CAST(CAST(ISNULL(CAST((DATEPART(HOUR,ISNULL(ALT_BeginTime,''00:00:00'')) * 60) AS FLOAT) + CAST(DATEPART(MINUTE,ISNULL(ALT_BeginTime,''00:00:00'')) * 1 AS FLOAT),0) AS VARCHAR(100)) AS FLOAT) AS ALTWORKTIME '
	SET @Strsql+='FROM tbl_EmpWorkingHoursDetails) EMPWHD ON EMPWHD.hourId=EMPWH.Id '
	SET @Strsql+='WHERE CONVERT(NVARCHAR(10),ATTEN.Work_datetime,120) BETWEEN CONVERT(NVARCHAR(10),'''+@FROMDATE+''',120) AND CONVERT(NVARCHAR(10),'''+@TODATE+''',120) '
	SET @Strsql+='AND Login_datetime IS NULL AND Logout_datetime IS NOT NULL AND Isonleave=''true'' '
	SET @Strsql+='GROUP BY ATTEN.User_Id,CNT.cnt_internalId,CONVERT(NVARCHAR(10),ATTEN.Work_datetime,105),ATTEN.Isonleave '
	SET @Strsql+=') LOGINLOGOUT GROUP BY USERID,cnt_internalId,Login_datetime,ATTEN_STATUS) ATTEN ON ATTEN.cnt_internalId=CNT.cnt_internalId AND ATTEN.USERID=USR.user_id '
	SET @Strsql+=') AS DB '
	IF @STATEID<>'' AND @DESIGNID='' AND @EMPID=''
		SET @Strsql+='WHERE EXISTS (SELECT State_Id from #STATEID_LIST AS ST WHERE ST.State_Id=DB.STATEID) '
	ELSE IF @STATEID='' AND @DESIGNID<>'' AND @EMPID=''
		SET @Strsql+='WHERE EXISTS (SELECT deg_id from #DESIGNATION_LIST AS DS WHERE DS.deg_id=DB.deg_id) '
	ELSE IF @STATEID='' AND @DESIGNID='' AND @EMPID<>''
		SET @Strsql+='WHERE EXISTS (SELECT emp_contactId from #EMPLOYEE_LIST AS EMP WHERE EMP.emp_contactId=DB.EMPCODE) '
	ELSE IF @STATEID<>'' AND @DESIGNID='' AND @EMPID<>''
		BEGIN
			SET @Strsql+='WHERE EXISTS (SELECT State_Id from #STATEID_LIST AS ST WHERE ST.State_Id=DB.STATEID) '
			SET @Strsql+='AND EXISTS (SELECT emp_contactId from #EMPLOYEE_LIST AS EMP WHERE EMP.emp_contactId=DB.EMPCODE) '
		END
	ELSE IF @STATEID='' AND @DESIGNID<>'' AND @EMPID<>''
		BEGIN
			SET @Strsql+='WHERE EXISTS (SELECT deg_id from #DESIGNATION_LIST AS DS WHERE DS.deg_id=DB.deg_id) '
			SET @Strsql+='AND EXISTS (SELECT emp_contactId from #EMPLOYEE_LIST AS EMP WHERE EMP.emp_contactId=DB.EMPCODE) '
		END
	ELSE IF @STATEID<>'' AND @DESIGNID<>'' AND @EMPID=''
		BEGIN
			SET @Strsql+='WHERE EXISTS (SELECT State_Id from #STATEID_LIST AS ST WHERE ST.State_Id=DB.STATEID) '
			SET @Strsql+='AND EXISTS (SELECT deg_id from #DESIGNATION_LIST AS DS WHERE DS.deg_id=DB.deg_id) '
		END
	ELSE IF @STATEID<>'' AND @DESIGNID<>'' AND @EMPID<>''
		BEGIN
			SET @Strsql+='WHERE EXISTS (SELECT State_Id from #STATEID_LIST AS ST WHERE ST.State_Id=DB.STATEID) '
			SET @Strsql+='AND EXISTS (SELECT deg_id from #DESIGNATION_LIST AS DS WHERE DS.deg_id=DB.deg_id) '
			SET @Strsql+='AND EXISTS (SELECT emp_contactId from #EMPLOYEE_LIST AS EMP WHERE EMP.emp_contactId=DB.EMPCODE) '
		END
	--SELECT @Strsql
	EXEC SP_EXECUTESQL @Strsql

	DROP TABLE #DESIGNATION_LIST
	DROP TABLE #EMPLOYEE_LIST
	DROP TABLE #STATEID_LIST
	DROP TABLE #TEMPCONTACT
	-- Rev 3.0
	IF ((select IsAllDataInPortalwithHeirarchy from tbl_master_user where user_id=@USERID)=1)
	BEGIN
		DROP TABLE #EMPHR
		DROP TABLE #EMPHR_EDIT
	END
	-- End of Rev 3.0

	SET NOCOUNT OFF
END